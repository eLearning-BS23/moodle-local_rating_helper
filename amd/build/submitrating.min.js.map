{"version":3,"sources":["../src/submitrating.js"],"names":["define","$","notification","ajax","render_indivisual_rating","courseid","call","methodname","args","done","data","success","html","rated5","rated4","rated3","rated2","rated1","addNotification","message","result","type","fail","exception","e","render_ratings","htm","ratings","length","forEach","item","profilepicture","firstname","lastname","ratingdate","comment","generate_rating_star","rating","stars","i","render_avg_rating","rat","Math","round","toFixed","init","uid","document","on","val","prop","addClass"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_courseteaser_admin/sortorder\n * @copyright  2021 Brain station 23 <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'core/notification', 'core/ajax', 'core/str'], function ($, notification, ajax) {\n\n    function render_indivisual_rating(courseid) {\n        var wsfunction = 'get_indivisual_rating';\n        var params = {\n            'cmid': courseid\n        };\n\n        var request = {\n            methodname: wsfunction,\n            args: params\n        };\n\n        try {\n            ajax.call([request])[0].done(function (data) {\n                if (data.success == true) {\n                    $('#five-star').html(data.rated5);\n                    $('#four-star').html(data.rated4);\n                    $('#three-star').html(data.rated3);\n                    $('#two-star').html(data.rated2);\n                    $('#one-star').html(data.rated1);\n\n                } else {\n                    notification.addNotification({\n                        message: data.result,\n                        type: 'error'\n                    });\n                }\n            }).fail(notification.exception);\n        } catch (e) {\n        }\n\n    }\n\n    function render_ratings(courseid) {\n        var wsfunction = 'get_all_ratings';\n        var params = {\n            'cmid': courseid\n        };\n\n        var request = {\n            methodname: wsfunction,\n            args: params\n        };\n\n        try {\n            ajax.call([request])[0].done(function (data) {\n                if (data.success == true) {\n                    var htm = '';\n                    if (data.ratings.length > 0) {\n                        data.ratings.forEach((item) => {\n                            htm += '<div class=\"middle-last-part\">' +\n                                '                            <div class=\"person-rating\">' +\n                                '                                <div class=\"person\">' +item.profilepicture +\n                                '                                </div>' +\n                                '                                <p class=\"person-name\">' + item.firstname + ' ' + item.lastname + '</p>' +\n                                '                                <span class=\"date\">' + item.ratingdate + '</span>' +\n                                '                            </div>' +\n                                '                            <div class=\"person-comment\">' +\n                                '                                <p class=\"comment-of-person\"> ' + item.comment +\n                                '                                </p>' +\n                                '                                <div class=\"star-rate\">' +\n                                '                                    <h5 class=\"star-head\"> ' + generate_rating_star(item.rating) +\n                                '                                    </h5>' +\n                                '                                </div>' +\n                                '                            </div>' +\n                                '                        </div>';\n                        });\n                        $('#total-rating').html(data.ratings.length);\n                    }\n                    else {\n                        $('#total-rating').html('0');\n                        htm += 'No Rating Found';\n                    }\n                    $('#user-ratings').html(htm);\n\n                } else {\n                    notification.addNotification({\n                        message: data.result,\n                        type: 'error'\n                    });\n                }\n            }).fail(notification.exception);\n        } catch (e) {\n        }\n\n    }\n\n    function generate_rating_star(stars) {\n        var htm = '';\n        for (var i = 0; i < stars; i++) {\n            htm += '<i class=\"far fa-star star-icon-rate\" aria-hidden=\"true\"></i>';\n        }\n        return htm;\n    }\n\n    function render_avg_rating(courseid) {\n        var wsfunction = 'get_cm_rating';\n        var params = {\n            'cmid': courseid\n        };\n\n        var request = {\n            methodname: wsfunction,\n            args: params\n        };\n\n        try {\n            ajax.call([request])[0].done(function (data) {\n                if (data.success == true) {\n                    var htm = '';\n                    if (data.rating) {\n                        var rat = Math.round(data.rating).toFixed(1);\n                        for (var i = 0; i < Math.round(data.rating); i++) {\n                            htm += '<i class=\"far fa-star star-icon\"></i>';\n                        }\n                    } else {\n                        var rat = '0.0';\n                        htm += '<i class=\"star-icon\">No rating found</i>';\n                    }\n                    $('#avg_rating').html(rat);\n                    $('#avg_ret_star').html(htm);\n                } else {\n                    notification.addNotification({\n                        message: data.result,\n                        type: 'error'\n                    });\n                }\n            }).fail(notification.exception);\n        } catch (e) {\n        }\n\n    }\n\n    return {\n        init: function (courseid, uid) {\n            render_avg_rating(courseid);\n            render_indivisual_rating(courseid);\n            render_ratings(courseid);\n            $(document).on('click', '#submit_rating_form', function () {\n                var rating = $('input[name=\"star\"]:checked').val();\n                var comment = $('#comment').val();\n                if (rating == undefined) {\n                    notification.addNotification({\n                        message: 'rating field is required',\n                        type: 'error'\n                    });\n                    return false;\n                }\n\n                // API Call\n                var wsfunction = 'save_rating';\n                var params = {\n                    'userid': uid,\n                    'cmid': courseid,\n                    'rating': rating,\n                    'comment': comment,\n                };\n\n                var request = {\n                    methodname: wsfunction,\n                    args: params\n                };\n\n                try {\n                    ajax.call([request])[0].done(function (data) {\n                        if (data.success == 1) {\n                            $('input[name=\"star\"]').prop('checked', false);\n                            $('#rating-form').addClass('d-none');\n                            render_avg_rating(courseid);\n                            render_indivisual_rating(courseid);\n                            render_ratings(courseid);\n                            notification.addNotification({\n                                message: data.result,\n                                type: 'success'\n                            });\n\n                        } else {\n                            notification.addNotification({\n                                message: data.result,\n                                type: 'error'\n                            });\n                        }\n                    }).fail(notification.exception);\n                } catch (e) {\n                }\n\n            });\n        }\n    };\n});"],"file":"submitrating.min.js"}